#### Установка Samba
```bash
$ sudo apt install samba
```
###### Разные дистрибутивы по‑разному именуют юнит systemd для Samba:

**Debian, Ubuntu (до Debian 11):** используют имя smbd.service (и nmbd.service для NetBIOS).

**RHEL, CentOS, Fedora, AlmaLinux, Rocky Linux:** используют имя smb.service (и nmb.service).

**Debian 12 и новее:** поддерживают оба варианта (smb.service и smbd.service) для совместимости.

###### Что внутри

**smbd (демоном Samba)** — это реальный исполняемый процесс, который всегда называется smbd (независимо от имени юнита systemd).

**smb.service / smbd.service** — это конфигурационный файл systemd (юнит), указывающий, как запускать и контролировать процесс smbd.

###### Посмотрите список установленных юнитов
```bash
$ sudo systemctl list-unit-files | grep -E 'smb\.service|smbd\.service'
```
#### После установки добавим службу в автозагрузку
```bash
$ sudo systemctl enable smbd
```
#### После чего запустите службу smbd:
```bash
$ sudo systemctl start smbd
```
#### Соответственно для просмотра текущего состояния демона используйте команду:
```bash
$ sudo systemctl status smbd
```
> P.s. Если на виртуальном сервере во время предварительной настройки включен брандмауэр, то надо добавить разрешающее правило для установленной утилиты:
```bash
$ sudo ufw allow Samba
```
#### Редактируем конфигурационный файл samba. Переходим в каталог /etc/samba/ и сохраните файл smb.conf в качестве резервной копии под именем, например, smb_bak.conf.
```bash
$ cd /etc/samba
$ sudo cp smb.conf smb_bak.conf
```
> Теперь, когда есть резервная копия конфигурационного файла, вы можете корректировать его, имея возможность в любой момент отменить все внесённые изменения.

### Настройка каталога для анонимного доступа
Cоздадим директорию и откроем доступ к ней таким образом, чтобы клиент мог иметь возможность подключиться к ней без авторизации на сервере. 

Анонимный пользователь не сможет редактировать или удалять файлы и каталоги, находящиеся в общей директории, а также у него не будет возможности создавать в ней свои директории или файлы.

Сначала создайте директорию, которую будете использовать для общего доступа. Например:
```bash
$ sudo mkdir /var/public_anon
```
Теперь перейдите в каталог /etc/samba/ и откройте для редактирования конфигурационный файл:
```bash
$ cd /etc/samba
$ sudo nano smb.conf
```
В конец файла smb.conf добавьте следующий раздел:
```bash
[public_anon]
    comment = Directory For Anonymous Users
    path = /var/public_anon
    public = yes
    writable = no
    read only = yes
    guest ok = yes
```
Здесь:

**[public_anon]** – имя ресурса, которое будет видеть клиент;<br>
**comment** – комментарий к данному разделу конфигурационного файла (в нашем случае – Directory For Anonymous Users);<br>
**path** – каталог, к которому предоставлен общий доступ (в нашем примере – /var/share_anon);<br>
**public** – признак возможности доступа гостевым пользователям и пользователям, прошедшим авторизацию (значение yes подразумевает предоставление доступа на чтение для данных пользователей);<br>
**writable** – возможность внесения изменений в содержимое общего каталога;<br>
**read only** – право только на чтение (в нашем примере значение yes говорит о том, что все пользователи имеют право исключительно на чтение содержимого директории);<br>
**guest ok** – признак возможности доступа гостевой учётной записи.<br>

После окончания редактирования закройте файл с сохранением изменений. Для этого нажмите Ctrl x, затем y и Enter. Для того, чтобы внесённые в конфигурацию изменения применились, перезапустите службу smbd:
```bash
$ sudo systemctl restart smbd
```
При помощи команды testparm проверьте, что внесённые изменения стали частью конфигурации Samba.
```bash
$ sudo testparm
```
Теперь можно проверить доступ по IP, например \\ваш IP\

### Настройка каталога для доступа авторизованного пользователя
Настроим каталог, к которому авторизованные учётные записи будут иметь полный доступ. То есть, пользователи, прошедшие авторизацию на сервере смогут редактировать, создавать и удалять файлы и директории в данном каталоге.

Как и в предыдущем разделе, сначала создайте директорию, к которой будет предоставлен общий доступ:
```bash
$ sudo mkdir /var/share_access
```
Созданной директории необходимо дать права, позволяющие вносить изменения в её содержимое:
```bash
$ sudo chmod 777 /var/share_access
```
После чего, перейдите в каталог /etc/samba/ и откройте для редактирования файл конфигурации:
```bash
$ cd /etc/samba
$ sudo nano smb.conf
```
Далее, в конец конфигурационного файла добавьте следующий раздел:
```bash
[share_access]
    comment =  Directory For Registered Users
    path = /var/share_access
    public = no
    writable = yes
    read only = no
    guest ok = no
    create mask = 0775
    directory mask = 0775
    force create mode = 0775
    force directory mode = 0775
```
Здесь:

**[share_access]** – имя ресурса, которое будет видеть клиент при подключении;<br>
**comment** – комментарий к разделу конфигурационного файла (в нашем примере – Directory For Registetred Users);<br>
**path** – каталог, к которому будет предоставлен общий доступ (в нашем случае – /var/share_access);<br>
**public** – признак возможности доступа гостевым пользователям и всем учётным записям, прошедшим авторизацию (значение no подразумевает отсутствие публичного доступа);<br>
**writable** – возможность внесения изменений в содержимое общей директории;<br>
**read only** – право только чтение (в нашем примере значение no говорит о том, что всем пользователям, прошедшим авторизацию будет предоставлены права на создание, удаление и редактирование файлов и каталогов в общей директории;<br>
**guest ok** – признак возможности доступа гостевой учётной записи;<br>
**параметры create mask, directory mask, force create mode и force directory mode** определяют права, назначаемые создаваемым файлам и каталогам в общей директории.<br>

По окончании редактирования закройте файл с сохранением внесённых изменений (Ctrl x, затем y и Enter).

Далее создайте в системе пользователя, под именем которого вы будете подключаться к общей директории. В нашем примере такой пользователь будет иметь имя samba-user.
```bash
$ sudo useradd samba-user
```
Теперь добавьте созданную учётную запись в Samba. Именно она будет иметь полный доступ к каталогу /var/share_access/. <br>
При выполнении команды нужно создать пароль для данного пользователя. <br>
При помощи этого пароля пользователь будет подключаться к общей директории.
```bash
$ sudo smbpasswd -a samba-user
```
Для применения изменений, внесённых в конфигурацию Samba, перезапустите демон smbd:
```bash
$ sudo systemctl restart smbd
```
Проверить доступ к каталогу /var/share_access/ вы сможете набрав соответствующий IP-адрес в строке проводника. 

Далее, для того, чтобы попасть непосредственно в директорию share_access, система попросит вас ввести имя и пароль пользователя, имеющего доступ к ресурсам, настроенным при помощи Samba. 

В нашем примере таким пользователем является samba-user.

### Настройка каталога для доступа определённых пользователей и групп
В этом разделе рассмотрим, как настроить доступ к общей директории для строго определённых учётных записей и групп.

Также, как и на предыдущем шаге, сначала создайте каталог и присвойте ему соответствующие права:
```bash
$ sudo mkdir /var/share_group
$ sudo chmod 777 /var/share_group
```
Теперь перейдите в каталог /etc/samba/ и откройте для редактирования конфигурационный файл Samba:
```bash
$ cd /etc/samba
$ sudo nano smb.conf
```
В конец файла smb.conf добавьте следующий раздел:
```bash
[share_group]
    comment =  Directory For Users And Groups
    path = /var/share_group
    public = no
    writable = no
    read only = yes
    guest ok = no
    valid users = your-user, @your-group
    write list = samba-user1
    create mask = 0775
    directory mask = 0775
    force create mode = 0775
    force directory mode = 0775
    inherit owner = yes
```
Здесь:

**[share_group]** – имя ресурса, которое будет показано в проводнике при подключении;<br>
**comment** – комментарий к данному разделу конфигурационного файла (в нашем случае – Directory For Users And Groups);<br>
**path** – путь к общему каталогу (в нашем примере – /var/share_group);<br>
**public** – признак возможности доступа гостевым пользователям и всем учётным записям, прошедшим авторизацию (значение no подразумевает отсутствие публичного доступа);<br>
**writable** – возможность внесения изменений в содержимое общего каталога;<br>
**read only** – право только чтение (в нашем примере значение yes говорит о том, что все пользователи имеют право исключительно на чтение содержимого общего каталога);<br>
**guest ok** – признак возможности доступа гостевой учётной записи;<br>
**valid users** – учётные записи и группы пользователей, имеющие доступ к общему каталогу (переменные, начинающиеся с символа @, являются названиями групп);<br>
**write list** – учётные записи, которым предоставляются права на редактирование содержимого директории;<br>
**параметры create mask, directory mask, force create mode и force directory mode** определяют права, назначаемые создаваемым файлам и каталогам в общей директории;<br>
**inherit owner** – признак, определяющий наследование владельца при создании файлов и каталогов.<br>

После окончания редактирования файла конфигурации закройте его с сохранением изменений и перезапустите демон smbd.
```bash
$ sudo systemctl restart smbd
```
Для получения полноценного доступа к директории /var/share_group/ создайте пользователя, указанного в строке write list:
```bash
$ sudo useradd samba-user1
```
Исходя из конфигурации в нашем примере, доступ к общему каталогу будет иметь учётная запись your-user и группа your-group. При этом полные права на каталог share_group должен иметь пользователь, указанный в строке write list. <br>
Таким образом, необходимо сначала создать группу your-group, после чего добавить в неё учётную запись samba-user1.
```bash
$ sudo groupadd your-group
$ sudo usermod -aG your-group samba-user1
```
После чего добавьте созданного пользователя ещё и в локальный файл smbpasswd с изменением пароля данной учётной записи в Samba:
```bash
$ sudo smbpasswd -a samba-user1
```
Теперь, подключившись к общей директории со своего локального компьютера через проводник, проверьте возможность доступа к каталогу share_group при помощи пользователя samba-user1.









##### Установка Astra Linux с поддержкой AD.

Скачаваем файл ISO, по рекомендации это версии  

Версии такие с 1.7.4-24.04.2023_14.23 до 1.7.6.15-15.11.24_17.20 Смоленск

Устанавливаем виртуальную машину.

Подключаем репозитории.

Подключение репозиториев. Файлы программ Linux объединяются в пакеты и распространяются через специальные хранилища, называемые репозиториями.<br> 
Основным файлом для хранения списка доступных репозиториев является ``/etc/apt/sources.list``, дополнительные списки могут храниться в файлах ``*.list`` в директории ``/etc/apt/sources.list.d/``.<br> 
По умолчанию Astra Linux предлагает использовать репозитории ``stable``, которые соответствуют последней версии операционной системы, но для работы с ALD Pro требуется переключить репозитории на ``frozen``, чтобы гарантировать полную совместимость пакетов.<br> 
Обязательными для версии ``ALD Pro 2.2.1`` являются репозитории ``base`` и ``aldpro``.<br> 
В репозитории ``base`` продублированы репозитории ``main`` и ``update``, поэтому можно указывать ``base`` вместо ``main`` и ``update``.<br> 
Пакеты из репозитория ``extended`` продублированы в репозитории ``aldpro``, поэтому в данном случае репозиторий ``extended`` можно не указывать. <br>
>[Warning!]
>Т.е. нужно указать репозитории или ``main + update + aldpro`` или ``base + aldpro``.<br>
Переходим в редактор файла

``nano /etc/apt/sources.list``

Добавляем репозитории
```bash
cat /etc/apt/sources.list
nano /etc/apt/sources.list
# Astra Linux repository description https://wiki.astralinux.ru/x/0oLiC
# Основной репозиторий
deb https://dl.astralinux.ru/astra/stable/1.7_x86-64/repository-main/     1.7_x86-64 main contrib non-free
# Оперативные обновления основного репозитория
deb https://dl.astralinux.ru/astra/stable/1.7_x86-64/repository-update/   1.7_x86-64 main contrib non-free

deb https://dl.astralinux.ru/astra/frozen/1.7_x86-64/1.7.3/repository-base/          1.7_x86-64 main contrib non-free
deb https://dl.astralinux.ru/astra/frozen/1.7_x86-64/1.7.3/repository-extended/      1.7_x86-64 main contrib non-free
deb https://dl.astralinux.ru/astra/frozen/1.7_x86-64/1.7.3/uu/2/repository-base/     1.7_x86-64 main contrib non-free
deb https://dl.astralinux.ru/astra/frozen/1.7_x86-64/1.7.3/uu/2/repository-extended/ 1.7_x86-64 main contrib non-free
```
Далее обновляем
```bash
apt update
apt dist-upgrade
```
Теперь в папкe ``cat > /etc/apt/sources.list.d/aldpro.list`` создаём файл с записью
```bash
первая версия aldpro
deb https://dl.astralinux.ru/aldpro/frozen/01/2.3.0 1.7_x86-64 main base
я прописал последнюю версию
deb https://dl.astralinux.ru/aldpro/frozen/01/2.5.0 1.7_x86-64 main base
```

P.s. Почему домен поддомен второго уровня и не .local а .lan, так рекомендуют. Делаем всё по фешую.
В документации и обучающих курсах применяются домены contoso.com или ad.example.test, которые используют для обучающих целей, но не приемлемы для развёртывания продуктивных сред. 
Поэтому рекомендуется придерживаться следующих правил: 
- Лучший вариант- это использовать свой домен третьего уровня. Например, если организация приобрела домен mycompany.ru для своего Web-сайта и почты, то для ALD Pro можно использовать доменное имя третьего уровня ald.mycompany.ru. 28Если в группе компаний планируется несколько юридических лиц, то каждому юр. лицу можно создать домен четвертого уровня. 
Таким образом будет гарантироваться отсутствие конфликтов с публичными DNS-именами.
- Если публичный домен не используется, то можно задействовать зоны .lan или .internal, например, ald.company.lan. Во многих инструкциях упоминается возможность использования зоны .local в качестве частного домена верхнего уровня для внутренних нужд предприятия, но в этом случае возникают конфликты Multicast DNS(RFC6762) и невозможность использования протокола zeroconf, который реализован в Linux службой Avahi, поэтому данная зона не рекомендуется.

>[!Warning]
>При изменении уровня защищенности:
- В сторону снижения уровня защищенности: автоматически отключаются опции, которые для данного уровня защищенности недоступны;
- В сторону увеличения уровня защищенности: при увеличении уровня защищенности состояние опций (МРД и МКЦ) автоматически не изменяется, но опции, доступные в новом режиме, становятся доступными для включения.

Из того, что "состояние опций автоматически не изменяется"  следует, что после выполнения команды повышения уровня, например: 
```bash
sudo astra-modeswitch set 2
нужно будет отдельно включить необходимые опции. Полный набор команд для включения всех опций:
sudo astra-mic-control enable
sudo astra-mac-control enable
sudo astra-digsig-control enable
sudo astra-secdel-control enable
sudo astra-swapwiper-control enable
```

Далее, настройка.

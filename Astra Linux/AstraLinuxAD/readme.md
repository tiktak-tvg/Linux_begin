##### Некоторые моменты для ясности.

Версии с 1.7.4-24.04.2023_14.23 до 1.7.6.15-15.11.24_17.20 версия ядра 5.5 Смоленск <br>
Версии 1.8.х	Astra Linux Special Edition	версия ядра 6.1/6.6*

##### Общие изменения версии с 1.7.x и версии 1.8.x<br>
В качестве основы для построения дистрибутива ОС использована пакетная база Debian 12 (Bookworm). Предыдущее очередное обновление Astra Linux Special Edition x.7 основано на пакетной базе Debian 10 (Buster).<br>
На ядре версии 6.1 реализована возможность автоматического управления частотой процессоров Intel (P-state).<br>
Изменена структура репозиториев ОС. Репозитории ОС:<br>
- основной репозиторий (main) – реализует все функциональные возможности и функции безопасности без использования пакетов из других репозиториев (замкнут по времени исполнения). Содержит пакеты поддержки оборудования и драйверы для распространенных устройств и устройств на длительной поддержке;
- расширенный репозиторий (extended) – содержит средства разработки (инструменты разработки, дополнительные библиотеки, дополнительные интерпретаторы) и пакеты для сборки основного репозитория, а также дополнительные прикладные и системные пакеты.<br>

В программе установки ОС (пакет astra-installer) реализованы следующие улучшения:
- запуск программы установки осуществляется через LiveCD;
- на этапе установки поддерживается возможность выбора сервера синхронизации времени, который в дальнейшем по умолчанию будет использоваться в установленной системе;
- взамен устаревшей серверной службы синхронизации времени ntp автоматически устанавливается клиентская служба  systemd-timesyncd (если при установке ОС был выбран для установки компонент "Консольные утилиты");
- поддерживается возможность подключения дополнительных репозиториев;
- доступно добавление дополнительных пакетов/списков пакетов для установки из репозиториев;
- реализована возможность монтирования в устанавливаемой ОС и/или в LiveCD сетевой файловой системы NFS-сервера, а также использовать NFS-сервер в качестве основного или дополнительного источника пакетов;
- на этапе разметки диска для профиля "Использовать EXT4 с LVM и отдельным разделом /home" реализована возможность включения/отключения резервирования непрерывного свободного дискового пространства. Включение резервирования свободного непрерывного места на диске позволит производить автоматизированную миграцию на следующее очередное обновление Astra Linux (по умолчанию резервирование включено);
- добавлена возможность создания локальных пользователей непосредственно при установке Astra Linux;
- для программы установки разработан файл ответов astra-installer-preseed.yaml. Также разработан конвертер, позволяющий адаптировать файл ответов инструмента debian-installer (preseed.cfg) к формату файла ответов astra-installer;
- поддерживается возможность запуска VNC сервера для удаленного подключения к клиентским машинам и управления ими как на этапе загрузки с установочного диска в главном меню программы установки, так и непосредственно в LiveCD;
- при запуске программы установки в виртуальной машине производится дополнительная установка пакета spice-vdagent, улучшающего интеграцию окна гостевой системы.<br>
**Реализован механизм автоматизированного перехода с очередного обновления 1.7 на очередное обновление 1.8 (механизм миграции).**

>[!Warning]
>Почему домен поддомен второго уровня и не .local а .lan, так рекомендуют. 
В документации и обучающих курсах применяются домены contoso.com или ad.example.test, которые используют для обучающих целей, но не приемлемы для развёртывания продуктивных сред. 
Поэтому рекомендуется придерживаться следующих правил: 
- Лучший вариант- это использовать свой домен третьего уровня. Например, если организация приобрела домен mycompany.ru для своего Web-сайта и почты, то для ALD Pro можно использовать доменное имя третьего уровня ald.mycompany.ru. 28Если в группе компаний планируется несколько юридических лиц, то каждому юр. лицу можно создать домен четвертого уровня. 
Таким образом будет гарантироваться отсутствие конфликтов с публичными DNS-именами.
- Если публичный домен не используется, то можно задействовать зоны .lan или .internal, например, ald.company.lan. Во многих инструкциях упоминается возможность использования зоны .local в качестве частного домена верхнего уровня для внутренних нужд предприятия, но в этом случае возникают конфликты Multicast DNS(RFC6762) и невозможность использования протокола zeroconf, который реализован в Linux службой Avahi, поэтому данная зона не рекомендуется.

>[!Warning]
>При изменении уровня защищенности:
- В сторону снижения уровня защищенности: автоматически отключаются опции, которые для данного уровня защищенности недоступны;
- В сторону увеличения уровня защищенности: при увеличении уровня защищенности состояние опций (МРД и МКЦ) автоматически не изменяется, но опции, доступные в новом режиме, становятся доступными для включения.

Из того, что "состояние опций автоматически не изменяется"  следует, что после выполнения команды повышения уровня, например: 
```bash
sudo astra-modeswitch set 2
нужно будет отдельно включить необходимые опции. Полный набор команд для включения всех опций:
sudo astra-mic-control enable
sudo astra-mac-control enable
sudo astra-digsig-control enable
sudo astra-secdel-control enable
sudo astra-swapwiper-control enable
```



Подключаем репозитории.

Подключение репозиториев. Файлы программ Linux объединяются в пакеты и распространяются через специальные хранилища, называемые репозиториями.<br> 
Основным файлом для хранения списка доступных репозиториев является ``/etc/apt/sources.list``, дополнительные списки могут храниться в файлах ``*.list`` в директории ``/etc/apt/sources.list.d/``.<br> 
По умолчанию Astra Linux предлагает использовать репозитории ``stable``, которые соответствуют последней версии операционной системы, но для работы с ALD Pro требуется переключить репозитории на ``frozen``, чтобы гарантировать полную совместимость пакетов.<br> 
Обязательными для версии ``ALD Pro 2.2.1`` являются репозитории ``base`` и ``aldpro``.<br> 
В репозитории ``base`` продублированы репозитории ``main`` и ``update``, поэтому можно указывать ``base`` вместо ``main`` и ``update``.<br> 
Пакеты из репозитория ``extended`` продублированы в репозитории ``aldpro``, поэтому в данном случае репозиторий ``extended`` можно не указывать. <br>
>[Warning!]
>Т.е. нужно указать репозитории или ``main + update + aldpro`` или ``base + aldpro``.<br>
Переходим в редактор файла

``nano /etc/apt/sources.list``

Добавляем репозитории ``base + aldpro``
```bash
cat /etc/apt/sources.list
nano /etc/apt/sources.list
# Astra Linux repository description https://wiki.astralinux.ru/x/0oLiC
# Основной репозиторий
# deb https://dl.astralinux.ru/astra/stable/1.7_x86-64/repository-main/     1.7_x86-64 main contrib non-free
# Оперативные обновления основного репозитория
deb https://dl.astralinux.ru/astra/stable/1.7_x86-64/repository-update/   1.7_x86-64 main contrib non-free
# Рекомендуемые репозитории для установки сервера
deb https://dl.astralinux.ru/astra/frozen/1.7_x86-64/1.7.3/repository-base/          1.7_x86-64 main contrib non-free
deb https://dl.astralinux.ru/astra/frozen/1.7_x86-64/1.7.3/repository-extended/      1.7_x86-64 main contrib non-free
deb https://dl.astralinux.ru/astra/frozen/1.7_x86-64/1.7.3/uu/2/repository-base/     1.7_x86-64 main contrib non-free
deb https://dl.astralinux.ru/astra/frozen/1.7_x86-64/1.7.3/uu/2/repository-extended/ 1.7_x86-64 main contrib non-free
```
>[!Warning]
>Некоторые пояснения по репозиториям репозиториям
```bash
Astra Linux main contrib non-free — это группа пакетов, объединённая по условиям использования:

non-free — группа содержит пакеты, которые не соответствуют принципам свободного ПО, имеют патенты или другие юридические ограничения; 
aldpro.ru
contrib — группа содержит пакеты, которые сами по себе соответствуют принципам свободного ПО, но зависят от пакетов из группы «non-free» (то есть не могут без них работать); 
aldpro.ru
main — группа содержит пакеты свободного ПО, которые не зависят от пакетов из групп «contrib» и «non-free». 
```
Посмотрим на версии репозиториев
```bash
apt policy apt-transport-https ca-certificates 
```
![image](https://github.com/user-attachments/assets/1e243c26-a050-400d-a168-748549607a79)

Далее обновляем
```bash
apt update && sudo apt list --upgradable && sudo apt dist-upgrade -y -o Dpkg::Options::=--force-confnew
```
Далее, настройка.
